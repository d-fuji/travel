# 旅程画像挿入機能 PRD (Product Requirements Document)

## 概要

旅行計画アプリの旅程機能に画像挿入機能を追加し、視覚的でわかりやすい旅程作成を可能にする。

## 目的

- 旅程をより視覚的で魅力的に表現する
- 場所や活動のイメージを共有しやすくする
- 旅程の理解度と記憶に残りやすさを向上させる
- 旅行前の期待感と旅行後の思い出保存を強化する

## 対象ユーザー

- 視覚的な旅程作成を好むユーザー
- SNS映えする旅程を作りたいユーザー
- 詳細な旅行計画を立てたいユーザー
- 旅行の思い出を記録したいユーザー

## 機能要件

### 1. 画像挿入機能

#### 1.1 画像の追加方法
- **カメラ撮影**：その場で写真を撮影して追加
- **ギャラリー選択**：端末内の既存画像から選択
- **URL指定**：ウェブ上の画像URLを指定
- **ドラッグ&ドロップ**：デスクトップからの直接ドラッグ

#### 1.2 対応画像形式
- JPEG, PNG, WebP, GIF（アニメーション含む）
- 最大ファイルサイズ：10MB
- 推奨解像度：1920x1080以下

#### 1.3 画像の配置
- 旅程アイテムのメイン画像として設定
- 複数画像の追加（最大5枚まで）
- 画像の並び順変更
- 画像とテキストの組み合わせ表示

### 2. 画像管理機能

#### 2.1 画像の編集
- **基本編集**：トリミング、回転、明度・彩度調整
- **リサイズ**：表示サイズの調整
- **キャプション**：画像の説明テキスト追加
- **代替テキスト**：アクセシビリティ対応

#### 2.2 画像の削除・置換
- 個別画像の削除
- 画像の置換（既存画像を新しい画像に差し替え）
- 一括削除機能

### 3. 表示・レイアウト機能

#### 3.1 表示オプション
- **サムネイル表示**：小さなプレビュー画像
- **フル表示**：大きな画像表示
- **スライドショー**：複数画像の自動切り替え
- **グリッド表示**：複数画像を格子状に配置

#### 3.2 レスポンシブ対応
- モバイル端末での最適表示
- 画面サイズに応じた自動リサイズ
- タッチ操作でのズーム・スワイプ対応

### 4. パフォーマンス最適化

#### 4.1 画像圧縮
- アップロード時の自動圧縮
- 品質設定の選択（高画質・標準・軽量）
- プログレッシブJPEG対応

#### 4.2 遅延読み込み
- 画像の遅延読み込み（Lazy Loading）
- プレースホルダー表示
- 読み込み進捗の表示

### 5. 共有・エクスポート機能

#### 5.1 画像共有
- 個別画像の共有
- 旅程全体の画像付きエクスポート
- SNS向けフォーマットでの出力

#### 5.2 印刷対応
- 画像付き旅程の印刷レイアウト
- PDF形式でのエクスポート

## 技術仕様

### データ構造

```typescript
interface ItineraryImage {
  id: string;
  itineraryItemId: string;
  url: string;
  thumbnailUrl: string;
  originalFileName: string;
  mimeType: string;
  fileSize: number;
  width: number;
  height: number;
  caption?: string;
  altText?: string;
  order: number;
  isMain: boolean;
  uploadedBy: string;
  uploadedAt: Date;
}

interface ImageUploadOptions {
  quality: 'high' | 'medium' | 'low';
  maxWidth?: number;
  maxHeight?: number;
  enableCompression: boolean;
}

interface ItineraryItem {
  // ... 既存のフィールド
  images: ItineraryImage[];
  mainImageId?: string;
  showImages: boolean;
  imageDisplayMode: 'thumbnail' | 'full' | 'slideshow' | 'grid';
}
```

### UI/UX設計

#### 画像追加UI
1. **追加ボタン**：旅程アイテム内に「画像追加」ボタン
2. **選択モーダル**：カメラ・ギャラリー・URL入力の選択
3. **プレビュー画面**：選択した画像の確認・編集
4. **アップロード進捗**：アップロード状況の表示

#### 画像表示UI
1. **サムネイル**：旅程アイテム内の小さな画像表示
2. **画像ビューア**：タップで拡大表示・スワイプ操作
3. **編集メニュー**：長押しで編集・削除メニュー表示
4. **キャプション**：画像下部に説明テキスト表示

#### レスポンシブデザイン
- モバイル：縦向きレイアウト、タッチ操作最適化
- タブレット：グリッド表示、ドラッグ&ドロップ対応
- デスクトップ：大画面表示、キーボードショートカット

#### UI/UX実装要件（開発標準）
- **統一モーダルデザイン**：`fixed inset-0 bg-black bg-opacity-50` の共通スタイル
- **z-index管理**：モーダル重なり順序の適切な管理（z-50, z-60等）
- **画像最適化**：WebP対応、プログレッシブ読み込み
- **エラーハンドリング**：画像読み込み失敗時の適切な表示
- **パフォーマンス**：遅延読み込み、キャッシュ活用

## 実装フェーズ

### Phase 1: 基本画像機能
- [ ] 画像のアップロード（カメラ・ギャラリー）
- [ ] 基本的な画像表示
- [ ] 画像の削除機能
- [ ] サムネイル生成
- [ ] 基本的なレスポンシブ対応

### Phase 2: 管理・編集機能
- [ ] 複数画像対応
- [ ] 画像の並び順変更
- [ ] 基本的な画像編集（トリミング、回転）
- [ ] キャプション機能
- [ ] 表示モード切替

### Phase 3: 高度な機能
- [ ] 画像圧縮・最適化
- [ ] 遅延読み込み
- [ ] スライドショー機能
- [ ] URL指定アップロード
- [ ] エクスポート機能

### Phase 4: パフォーマンス・UX向上
- [ ] 高度な画像編集
- [ ] 一括操作機能
- [ ] オフライン対応
- [ ] アクセシビリティ強化

## 成功指標

- 画像機能の使用率：60%以上
- 画像付き旅程の作成率：40%以上
- ページ読み込み速度の維持（3秒以内）
- ユーザーの旅程作成満足度向上

## リスク・考慮事項

### 技術的リスク
- **パフォーマンス**：大量画像による読み込み速度低下
- **ストレージ**：画像ファイルによる容量増加
- **帯域幅**：モバイル環境での通信量増加

### UX/デザインリスク
- **レイアウト崩れ**：様々な画像サイズへの対応
- **操作複雑化**：機能追加による使いやすさの低下
- **アクセシビリティ**：視覚障害者への配慮不足

### 法的・セキュリティリスク
- **著作権**：他人の画像の無断使用
- **プライバシー**：個人情報を含む画像の取り扱い
- **容量制限**：ストレージコストの管理

## 関連ファイル

実装時に関連するファイル：
- `src/types/index.ts` - 画像関連の型定義追加
- `src/stores/travelStore.ts` - 画像データの状態管理
- `src/components/ItineraryBoard.tsx` - 旅程表示の拡張
- `src/components/ImageUploader.tsx` - 画像アップロード機能
- `src/components/ImageViewer.tsx` - 画像表示・編集機能
- `src/utils/imageUtils.ts` - 画像処理ユーティリティ
- `src/services/imageApi.ts` - 画像関連API処理